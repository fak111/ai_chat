# A宝 - 功能摘要

## 文档信息

| 项目 | 内容 |
|------|------|
| 版本 | v1.0 |
| 创建日期 | 2026-02-05 |
| 来源文档 | PRD.md |

## 1. 功能总览

### 1.1 功能统计

| 类别 | 数量 |
|------|------|
| 功能模块 | 4 个 |
<!-- MODIFIED: 原内容为 "10 个" -->
| P0 功能 | 11 个 |
| P1 功能 | 2 个 |
| P2 功能 | 2 个 |

### 1.2 功能架构图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                 A宝                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐            │
│  │    用户系统     │  │  群聊系统(派)   │  │    AI 系统     │            │
│  │ ────────────── │  │ ────────────── │  │ ────────────── │            │
│  │ • 邮箱注册  P0 │  │ • 创建群聊  P0 │  │ • AI群成员  P0 │            │
│  │ • 邮箱登录  P0 │  │ • 加入群聊  P0 │  │ • @AI触发   P0 │            │
│  │ • 登录态    P0 │  │ • 群聊列表  P0 │  │ • 引用AI    P0 │            │
│  │               │  │ • 发送消息  P0 │  │               │            │
│  │               │  │ • 接收消息  P0 │  └────────────────┘            │
│  │               │  │ • 历史消息  P1 │                                 │
│  │               │  │ • 邀请分享  P1 │  ┌────────────────┐            │
│  └────────────────┘  └────────────────┘  │     设置       │            │
│                                          │ ────────────── │            │
│                                          │ • 主题色    P2 │            │
│                                          │ • 消息中心  P2 │            │
│                                          └────────────────┘            │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.3 模块依赖关系

```
                    ┌────────────────┐
                    │    用户系统     │
                    │  (认证基础)     │
                    └───────┬────────┘
                            │
            ┌───────────────┼───────────────┐
            │               │               │
            ▼               ▼               ▼
    ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
    │ 群聊系统(派)  │ │   AI 系统    │ │    设置      │
    │              │ │              │ │              │
    └──────┬───────┘ └──────┬───────┘ └──────────────┘
           │                │
           │    依赖        │
           └───────┬────────┘
                   │
                   ▼
           ┌──────────────┐
           │   群聊消息    │
           │  (消息承载)   │
           └──────────────┘
```

**依赖说明**：
- 群聊系统、AI 系统、设置均依赖用户系统的认证能力
- AI 系统的消息回复依赖群聊系统的消息通道
- 设置模块相对独立，仅依赖用户系统

## 2. 功能清单

### 2.1 用户系统

**模块职责**: 提供用户注册、登录和身份认证服务

#### 功能列表

| ID | 功能 | 描述 | 优先级 | 关联用户故事 |
|----|------|------|--------|--------------|
| F-001 | 邮箱注册 | 用户使用邮箱地址注册新账号 | P0 | US-001 |
| F-002 | 邮箱登录 | 用户使用邮箱和密码登录应用 | P0 | US-002 |
| F-003 | 登录态管理 | 维持用户登录状态，支持自动登录 | P0 | US-002 |

#### 功能契约详情

**F-001: 邮箱注册**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 用户点击"注册"按钮 |
| **输入** | 邮箱地址、密码、昵称（可选） |
| **处理逻辑** | 1. 校验邮箱格式 2. 检查邮箱是否已注册 3. 发送验证邮件 4. 用户点击验证链接 5. 创建账号 |
| **输出** | 注册成功/失败状态，成功则自动登录 |
| **异常情况** | 邮箱格式错误、邮箱已注册、验证邮件发送失败、验证链接过期 |
| **边界说明** | 不支持手机号注册；密码规则待定（建议最少8位含字母数字） |

**F-002: 邮箱登录**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 用户点击"登录"按钮 |
| **输入** | 邮箱地址、密码 |
| **处理逻辑** | 1. 校验邮箱格式 2. 验证邮箱密码匹配 3. 生成登录凭证 4. 进入主页 |
| **输出** | 登录成功进入主页，或显示错误提示 |
| **异常情况** | 邮箱未注册、密码错误、账号被锁定（多次失败） |
| **边界说明** | 支持登录失败次数限制（防暴力破解） |

**F-003: 登录态管理**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 用户打开应用 |
| **输入** | 本地存储的登录凭证 |
| **处理逻辑** | 1. 检查本地是否有有效凭证 2. 验证凭证有效性 3. 有效则自动进入主页，无效则跳转登录页 |
| **输出** | 自动登录或跳转登录页 |
| **异常情况** | 凭证过期、凭证被撤销 |
| **边界说明** | 凭证有效期待定；不支持多端登录互踢（MVP） |

---

### 2.2 群聊系统（派）

**模块职责**: 提供群聊创建、加入、消息收发等核心社交功能

#### 功能列表

| ID | 功能 | 描述 | 优先级 | 关联用户故事 |
|----|------|------|--------|--------------|
| F-004 | 创建群聊 | 用户创建新的群聊空间（派） | P0 | US-003 |
| F-005 | 加入群聊 | 用户通过邀请码加入已有群聊 | P0 | US-004 |
| F-006 | 群聊列表 | 展示用户加入的所有群聊 | P0 | US-003, US-004 |
| F-007 | 发送消息 | 在群聊中发送文字消息 | P0 | US-005 |
| F-008 | 接收消息 | 实时接收群内成员消息 | P0 | US-005 |
| F-009 | 历史消息 | 查看群聊历史记录 | P1 | US-009 |
| F-010 | 邀请码分享 | 获取和分享群聊邀请码 | P1 | US-008 |

#### 功能契约详情

**F-004: 创建群聊**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 用户点击"创建群聊"按钮 |
| **输入** | 群聊名称（1-50字符） |
| **处理逻辑** | 1. 校验群名称 2. 创建群聊 3. 生成邀请码 4. 将创建者加入群聊 5. 添加 AI 成员 |
| **输出** | 群聊创建成功，显示在群聊列表，可进入群聊页面 |
| **异常情况** | 群名称为空、群名称过长、创建失败 |
| **边界说明** | 无群主概念，所有成员权限平等；每个群聊自动包含 AI 成员 |

**F-005: 加入群聊**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 用户点击"加入群聊"并输入邀请码 |
| **输入** | 邀请码（6-10位字母数字） |
| **处理逻辑** | 1. 校验邀请码格式 2. 验证邀请码有效性 3. 检查是否已加入 4. 将用户加入群聊 |
| **输出** | 加入成功，群聊显示在列表 |
| **异常情况** | 邀请码无效、邀请码过期、已加入该群 |
| **边界说明** | 邀请码时效性/使用次数待定 |

**F-006: 群聊列表**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 用户进入主页 |
| **输入** | 用户ID |
| **处理逻辑** | 1. 查询用户加入的所有群聊 2. 按最近活跃时间排序 3. 显示群名称、最新消息预览、未读数 |
| **输出** | 群聊列表（有序） |
| **异常情况** | 网络错误、数据加载失败 |
| **边界说明** | MVP 不支持群聊搜索、置顶、免打扰 |

**F-007: 发送消息**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 用户在群聊中点击"发送"按钮 |
| **输入** | 消息内容（文字）、群聊ID、发送者ID |
| **处理逻辑** | 1. 校验消息内容非空 2. 保存消息到服务器 3. 推送给群内所有成员 4. 本地显示消息 |
| **输出** | 消息显示在聊天记录中 |
| **异常情况** | 消息内容为空、网络错误、发送超时 |
| **边界说明** | MVP 仅支持文字消息；消息最大长度待定；不支持撤回、编辑 |

**F-008: 接收消息**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 群内有新消息（其他成员发送或 AI 回复） |
| **输入** | 消息内容、发送者信息、时间戳 |
| **处理逻辑** | 1. 服务器推送消息 2. 客户端接收 3. 实时显示在聊天界面 4. 更新未读计数 |
| **输出** | 新消息实时显示 |
| **异常情况** | 网络断开、消息丢失 |
| **边界说明** | 要求消息发送延迟 < 1秒 |

**F-009: 历史消息**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 用户在群聊中向上滚动 |
| **输入** | 群聊ID、当前最早消息ID |
| **处理逻辑** | 1. 检测滚动到顶部 2. 请求更早的历史消息 3. 加载并显示 |
| **输出** | 历史消息按时间顺序显示 |
| **异常情况** | 无更多历史、加载失败 |
| **边界说明** | 分页加载，每页数量待定 |

**F-010: 邀请码分享**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 用户进入群设置页面 |
| **输入** | 群聊ID |
| **处理逻辑** | 1. 获取群聊邀请码 2. 显示邀请码 3. 支持复制到剪贴板 |
| **输出** | 邀请码文本，可复制分享 |
| **异常情况** | 获取失败 |
| **边界说明** | 所有群成员均可获取和分享邀请码（无群主限制） |

---

### 2.3 AI 系统

**模块职责**: 提供群聊内的 AI 交互能力，让用户能与 AI 对话

#### 功能列表

| ID | 功能 | 描述 | 优先级 | 关联用户故事 |
|----|------|------|--------|--------------|
| F-011 | AI 群成员 | 每个群聊包含 AI 成员 | P0 | US-006 |
| F-012 | @AI 触发回复 | 用户 @AI 后 AI 自动回复 | P0 | US-006 |
| F-013 | 引用 AI 回复 | 用户可引用 AI 回复继续对话 | P0 | US-007 |

#### 功能契约详情

**F-011: AI 群成员**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 群聊创建时 / 用户进入群聊时 |
| **输入** | 群聊ID |
| **处理逻辑** | 1. 群聊创建时自动添加 AI 成员 2. 群成员列表显示 AI 3. AI 有独特标识（头像、名称） |
| **输出** | AI 作为群成员显示 |
| **异常情况** | 无 |
| **边界说明** | AI 不可被移除；每个群固定一个 AI 成员（MVP） |

**F-012: @AI 触发回复**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 用户发送包含 @AI 的消息 |
| **输入** | 消息内容（含 @AI + 问题）、群聊ID |
| **处理逻辑** | 1. 检测消息中的 @AI 2. 提取问题内容 3. 调用 AI 服务获取回复 4. 将 AI 回复作为群消息发送 |
| **输出** | AI 在群内回复，所有成员可见 |
| **异常情况** | AI 服务不可用、响应超时、内容审核不通过 |
| **边界说明** | AI 响应时间 < 5秒；可能需要调用频率限制 |

**F-013: 引用 AI 回复**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 用户长按/点击 AI 回复选择"引用" |
| **输入** | 被引用的 AI 消息ID、追问内容 |
| **处理逻辑** | 1. 用户选择引用 AI 消息 2. 输入追问内容 3. 发送带引用的消息 4. AI 基于上下文（被引用消息）继续回复 |
| **输出** | 显示引用关系，AI 继续回复 |
| **异常情况** | 被引用消息不存在、AI 服务错误 |
| **边界说明** | 上下文范围待定（仅引用消息 or 整个对话链） |

---

### 2.4 设置

**模块职责**: 提供应用个性化设置和系统通知

#### 功能列表

| ID | 功能 | 描述 | 优先级 | 关联用户故事 |
|----|------|------|--------|--------------|
| F-014 | 主题色 | 设置应用主题颜色 | P2 | US-010 |
| F-015 | 消息中心 | 查看系统通知 | P2 | - |

#### 功能契约详情

**F-014: 主题色**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 用户进入设置页面选择主题 |
| **输入** | 主题色选项 |
| **处理逻辑** | 1. 显示可选主题色 2. 用户选择 3. 保存设置 4. 应用新主题 |
| **输出** | 界面配色更新 |
| **异常情况** | 保存失败 |
| **边界说明** | 预设主题色选项，不支持自定义颜色（MVP） |

**F-015: 消息中心**

| 契约项 | 说明 |
|--------|------|
| **触发条件** | 用户点击消息中心入口 |
| **输入** | 用户ID |
| **处理逻辑** | 1. 查询系统通知 2. 按时间排序显示 |
| **输出** | 系统通知列表 |
| **异常情况** | 无通知、加载失败 |
| **边界说明** | 仅显示系统通知，不包含聊天消息提醒 |

---

## 3. 功能依赖矩阵

| 功能 | F-001 | F-002 | F-003 | F-004 | F-005 | F-006 | F-007 | F-008 | F-011 | F-012 |
|------|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| F-001 邮箱注册 | - | | | | | | | | | |
| F-002 邮箱登录 | | - | | | | | | | | |
| F-003 登录态 | | ✓ | - | | | | | | | |
| F-004 创建群聊 | | | ✓ | - | | | | | | |
| F-005 加入群聊 | | | ✓ | | - | | | | | |
| F-006 群聊列表 | | | ✓ | ✓ | ✓ | - | | | | |
| F-007 发送消息 | | | ✓ | | | ✓ | - | | | |
| F-008 接收消息 | | | ✓ | | | ✓ | | - | | |
| F-009 历史消息 | | | ✓ | | | ✓ | | | | |
| F-010 邀请分享 | | | ✓ | | | ✓ | | | | |
| F-011 AI群成员 | | | | ✓ | | | | | - | |
| F-012 @AI触发 | | | | | | | ✓ | | ✓ | - |
| F-013 引用AI | | | | | | | ✓ | | | ✓ |
| F-014 主题色 | | | ✓ | | | | | | | |
| F-015 消息中心 | | | ✓ | | | | | | | |

**说明**：
- ✓ 表示行功能依赖列功能
- 空白表示无依赖
- F-003（登录态）是大多数功能的前置依赖

---

## 4. 功能流程图

### 4.1 新用户注册加入群聊流程

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
│ F-001   │ ──▶ │ F-003   │ ──▶ │ F-005   │ ──▶ │ F-006   │ ──▶ │ F-007   │
│邮箱注册  │     │登录态    │     │加入群聊  │     │群聊列表  │     │发送消息  │
└─────────┘     └─────────┘     └─────────┘     └─────────┘     └─────────┘
     │                               │
     ▼ 异常                          ▼ 异常
┌─────────┐                    ┌─────────┐
│邮箱已注册│                    │邀请码无效│
│跳转登录  │                    │ 重新输入 │
└─────────┘                    └─────────┘
```

### 4.2 创建群聊并邀请朋友流程

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
│ F-002   │ ──▶ │ F-004   │ ──▶ │ F-010   │ ──▶ │  分享   │
│邮箱登录  │     │创建群聊  │     │邀请分享  │     │给朋友   │
└─────────┘     └─────────┘     └─────────┘     └─────────┘
                     │
                     ▼ 自动
               ┌─────────┐
               │ F-011   │
               │AI加入群  │
               └─────────┘
```

### 4.3 与 AI 对话流程

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
│ F-007   │ ──▶ │ F-012   │ ──▶ │ F-008   │ ──▶ │ F-013   │
│发送消息  │     │@AI触发  │     │接收AI回复│     │引用继续  │
│(@AI问题)│     │AI处理   │     │群内显示  │     │ 追问    │
└─────────┘     └─────────┘     └─────────┘     └─────────┘
                     │                               │
                     ▼ 异常                          │ 循环
               ┌─────────┐                          │
               │AI服务错误│                    ◀─────┘
               │显示提示  │
               └─────────┘
```

### 4.4 老用户登录流程

```
┌─────────┐     ┌─────────┐     ┌─────────┐
│ 打开APP │ ──▶ │ F-003   │ ──▶ │ F-006   │
│         │     │检查登录态│     │群聊列表  │
└─────────┘     └─────────┘     └─────────┘
                     │
                     ▼ 凭证失效
               ┌─────────┐
               │ F-002   │
               │重新登录  │
               └─────────┘
```

---

## 5. 版本规划

| 版本 | 包含功能 | 功能ID | 目标 |
|------|----------|--------|------|
| MVP (Phase 1) | 邮箱注册、邮箱登录、登录态管理、创建群聊、加入群聊、群聊列表、发送消息、接收消息、AI群成员、@AI触发、引用AI回复 | F-001 ~ F-008, F-011 ~ F-013 | 核心功能可用，可发布 Android 应用 |
| v1.1 (Phase 2) | 历史消息、邀请码分享 | F-009, F-010 | 功能增强，提升用户体验 |
| v2.0 (Phase 3) | 主题色、消息中心、iOS版本 | F-014, F-015 | 平台扩展，个性化支持 |

---

## 6. 接口契约预览

> 详细接口定义在 DevelopmentPlan 中，此处仅列出关键接口

| 功能 | 接口类型 | 简要说明 |
|------|----------|----------|
| F-001 邮箱注册 | API | POST /auth/register - 注册新用户 |
| F-001 邮箱注册 | API | POST /auth/verify - 验证邮箱 |
| F-002 邮箱登录 | API | POST /auth/login - 用户登录 |
| F-004 创建群聊 | API | POST /groups - 创建群聊 |
| F-005 加入群聊 | API | POST /groups/join - 通过邀请码加入 |
| F-006 群聊列表 | API | GET /groups - 获取用户群聊列表 |
| F-007 发送消息 | WebSocket | send_message - 发送群消息 |
| F-008 接收消息 | WebSocket | on_message - 接收群消息 |
| F-010 邀请分享 | API | GET /groups/{id}/invite - 获取邀请码 |
| F-012 @AI触发 | API | POST /ai/chat - 调用 AI 服务 |
| F-013 引用AI | API | POST /ai/chat - 带上下文的 AI 对话 |
